<%- include('../../partials/header') %>

<div class="flex items-center justify-between mb-6">
  <div>
    <h1 class="text-2xl font-bold text-gray-900 dark:text-white"><%= list.name %></h1>
    <p class="text-sm text-gray-500 dark:text-gray-400">Created <%= new Date(list.createdAt).toLocaleDateString() %></p>
  </div>
  <a href="/grocery" class="btn-secondary text-sm">Back to Lists</a>
</div>

<% const unchecked = items.filter(i => i.checked === 0); %>
<% const checked = items.filter(i => i.checked !== 0); %>

<!-- Unchecked Items -->
<section class="mb-6">
  <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-3">To Buy (<%= unchecked.length %>)</h2>
  <% if (unchecked.length === 0) { %>
    <p class="text-sm text-gray-500 dark:text-gray-400 italic">All items checked off!</p>
  <% } else { %>
    <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm divide-y divide-gray-100 dark:divide-gray-700/50">
      <% unchecked.forEach(function(item) { %>
        <div class="flex items-center justify-between px-4 py-3">
          <div class="flex items-center gap-3 min-w-0">
            <form method="POST" action="/grocery/<%= list.id %>/items/<%= item.id %>/toggle">
              <input type="hidden" name="_csrf" value="<%= csrfToken %>">
              <button type="submit" class="w-5 h-5 rounded border-2 border-gray-300 dark:border-gray-600 hover:border-primary dark:hover:border-primary-light flex items-center justify-center transition-colors" title="Check off">
              </button>
            </form>
            <div class="min-w-0">
              <span class="text-sm font-medium text-gray-900 dark:text-white block truncate"><%= item.name %></span>
              <% if (item.amount || item.unit) { %>
                <span class="text-xs text-gray-500 dark:text-gray-400"><%= item.amount || '' %> <%= item.unit || '' %></span>
              <% } %>
              <% if (item.sourceRecipeTitle) { %>
                <span class="text-xs text-gray-400 dark:text-gray-500 block"><%= item.sourceRecipeTitle %></span>
              <% } %>
              <% if (item.isCustom) { %>
                <span class="tag text-xs">Custom</span>
              <% } %>
            </div>
          </div>
          <form method="POST" action="/grocery/<%= list.id %>/items/<%= item.id %>/delete">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <button type="submit" class="btn-ghost-danger text-xs">Remove</button>
          </form>
        </div>
      <% }); %>
    </div>
  <% } %>
</section>

<!-- Checked Items -->
<% if (checked.length > 0) { %>
  <section class="mb-6">
    <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-3">Done (<%= checked.length %>)</h2>
    <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm divide-y divide-gray-100 dark:divide-gray-700/50 opacity-60">
      <% checked.forEach(function(item) { %>
        <div class="flex items-center justify-between px-4 py-3">
          <div class="flex items-center gap-3 min-w-0">
            <form method="POST" action="/grocery/<%= list.id %>/items/<%= item.id %>/toggle">
              <input type="hidden" name="_csrf" value="<%= csrfToken %>">
              <button type="submit" class="w-5 h-5 rounded border-2 border-primary bg-primary dark:border-primary-light dark:bg-primary-light flex items-center justify-center transition-colors" title="Uncheck">
                <svg class="w-3 h-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>
              </button>
            </form>
            <span class="text-sm text-gray-500 dark:text-gray-400 line-through truncate"><%= item.name %></span>
          </div>
          <form method="POST" action="/grocery/<%= list.id %>/items/<%= item.id %>/delete">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <button type="submit" class="btn-ghost-danger text-xs">Remove</button>
          </form>
        </div>
      <% }); %>
    </div>
  </section>
<% } %>

<!-- Add Custom Item -->
<section class="mb-6">
  <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-3">Add Custom Item</h2>
  <form method="POST" action="/grocery/<%= list.id %>/add-item" class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-4">
    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
    <div class="flex gap-3 items-end">
      <div class="flex-1">
        <label class="form-label">Item Name</label>
        <input type="text" name="name" required class="form-input" placeholder="e.g., Paper towels">
      </div>
      <div class="w-24">
        <label class="form-label">Amount</label>
        <input type="text" name="amount" class="form-input" placeholder="1">
      </div>
      <div class="w-24">
        <label class="form-label">Unit</label>
        <input type="text" name="unit" class="form-input" placeholder="pack">
      </div>
      <button type="submit" class="btn-primary">Add</button>
    </div>
  </form>
</section>

<!-- Delete List -->
<section class="border-t border-gray-200 dark:border-gray-700 pt-6">
  <form method="POST" action="/grocery/<%= list.id %>/delete">
    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
    <button type="submit" class="btn-danger text-sm" onclick="return confirm('Delete this entire grocery list?')">
      <svg class="w-4 h-4 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
      Delete List
    </button>
  </form>
</section>

<%- include('../../partials/footer') %>
