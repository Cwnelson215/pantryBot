<%- include('../../partials/header') %>

<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
  <div class="flex items-center gap-3">
    <h1 class="text-2xl font-bold text-gray-900 dark:text-white">My Pantry</h1>
    <% if (typeof items !== 'undefined' && items.length > 0) { %>
      <span class="badge bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300"><%= items.length %> item<%= items.length !== 1 ? 's' : '' %></span>
    <% } %>
  </div>
  <a href="/pantry/add" class="btn-primary">
    <svg class="w-4 h-4 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
    Add Item
  </a>
</div>

<% if (typeof items !== 'undefined' && items.length > 0) { %>
  <%
    var categories = {};
    items.forEach(function(item) {
      var cat = item.category || 'Uncategorized';
      if (!categories[cat]) categories[cat] = [];
      categories[cat].push(item);
    });
  %>

  <% Object.keys(categories).sort().forEach(function(category) { %>
    <section class="mb-8">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-3 pb-2 border-b border-gray-200 dark:border-gray-700"><%= category %></h2>
      <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm overflow-hidden">
        <div class="overflow-x-auto">
          <table class="data-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Quantity</th>
                <th>Expiration</th>
                <th>Notes</th>
                <th class="text-right">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% categories[category].forEach(function(item) {
                var expClass = '';
                if (item.expirationDate) {
                  var now = new Date();
                  var exp = new Date(item.expirationDate);
                  var diffDays = Math.ceil((exp - now) / (1000 * 60 * 60 * 24));
                  if (diffDays <= 2) expClass = 'text-red-600 dark:text-red-400 font-medium';
                  else if (diffDays <= 5) expClass = 'text-amber-600 dark:text-amber-400 font-medium';
                }
              %>
                <tr>
                  <td class="font-medium text-gray-900 dark:text-white"><%= item.name %></td>
                  <td><%= item.quantity %> <%= item.unit %></td>
                  <td>
                    <% if (item.expirationDate) { %>
                      <span class="<%= expClass %>"><%= new Date(item.expirationDate).toLocaleDateString() %></span>
                    <% } else { %>
                      <span class="text-gray-400 dark:text-gray-500">--</span>
                    <% } %>
                  </td>
                  <td class="text-gray-500 dark:text-gray-400"><%= item.notes || '' %></td>
                  <td class="text-right">
                    <div class="flex items-center justify-end gap-1">
                      <a href="/pantry/<%= item.id %>/edit" class="btn-ghost text-xs">Edit</a>
                      <form method="POST" action="/pantry/<%= item.id %>/delete" class="inline">
                        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                        <button type="submit" class="btn-ghost-danger text-xs">Delete</button>
                      </form>
                    </div>
                  </td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
      </div>
    </section>
  <% }); %>
<% } else { %>
  <div class="text-center py-12">
    <div class="w-16 h-16 mx-auto mb-4 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center">
      <svg class="w-8 h-8 text-gray-400 dark:text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg>
    </div>
    <p class="text-gray-500 dark:text-gray-400 mb-4">Your pantry is empty.</p>
    <a href="/pantry/add" class="btn-primary">Add Your First Item</a>
  </div>
<% } %>

<%- include('../../partials/footer') %>
