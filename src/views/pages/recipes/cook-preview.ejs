<%- include('../../partials/header') %>

<h1 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Cook: <%= preview.recipe.title %></h1>
<p class="text-sm text-gray-500 dark:text-gray-400 mb-6">
  Cooking <%= preview.requestedServings %> serving<%= preview.requestedServings !== 1 ? 's' : '' %>
  <% if (preview.recipe.servings && preview.recipe.servings !== preview.requestedServings) { %>
    (recipe default: <%= preview.recipe.servings %>)
  <% } %>
</p>

<% if (preview.deductions.length > 0) { %>
  <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm p-5 mb-6">
    <h2 class="font-semibold text-gray-900 dark:text-white mb-3">Pantry Deductions</h2>
    <div class="space-y-2">
      <% preview.deductions.forEach(function(d) { %>
        <div class="flex items-center justify-between text-sm">
          <div>
            <span class="font-medium text-gray-900 dark:text-white"><%= d.pantryItemName %></span>
            <span class="text-gray-500 dark:text-gray-400">(for <%= d.ingredientName %>)</span>
          </div>
          <div class="text-right">
            <span class="text-red-600 dark:text-red-400">-<%= d.amountDeducted %> <%= d.unit %></span>
            <span class="text-gray-400 dark:text-gray-500 ml-2"><%= d.oldQuantity %> &rarr; <%= d.newQuantity %></span>
          </div>
        </div>
      <% }); %>
    </div>
  </div>
<% } %>

<% if (preview.skipped.length > 0) { %>
  <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-xl p-5 mb-6">
    <h2 class="font-semibold text-yellow-800 dark:text-yellow-300 mb-3">Skipped Items</h2>
    <div class="space-y-2">
      <% preview.skipped.forEach(function(s) { %>
        <div class="text-sm">
          <span class="font-medium text-yellow-800 dark:text-yellow-300"><%= s.ingredientName %></span>
          <span class="text-yellow-600 dark:text-yellow-400"> &mdash; <%= s.reason %></span>
        </div>
      <% }); %>
    </div>
  </div>
<% } %>

<% if (preview.replenishItems.length > 0) { %>
  <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-5 mb-6">
    <h2 class="font-semibold text-blue-800 dark:text-blue-300 mb-3">Will Auto-Replenish</h2>
    <p class="text-xs text-blue-600 dark:text-blue-400 mb-2">These staple items will drop below 90% and be added to your Auto-Replenish grocery list.</p>
    <div class="space-y-1">
      <% preview.replenishItems.forEach(function(r) { %>
        <div class="text-sm text-blue-700 dark:text-blue-400">
          <span class="font-medium"><%= r.name %></span>
          &mdash; <%= r.currentQuantity %>/<%= r.originalQuantity %> <%= r.unit %> remaining
        </div>
      <% }); %>
    </div>
  </div>
<% } %>

<div class="flex flex-col sm:flex-row gap-3">
  <form method="POST" action="/recipes/saved/<%= preview.recipe.id %>/cook/confirm">
    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
    <input type="hidden" name="servings" value="<%= preview.requestedServings %>">
    <button type="submit" class="btn-primary">Confirm Cook</button>
  </form>
  <a href="/recipes/saved" class="btn-secondary text-center">Cancel</a>
</div>

<%- include('../../partials/footer') %>
